package com.paul;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Iterator;
import java.util.List;
import java.util.TimeZone;
import edu.virginia.dtc.Tvector.Tvector;
import Jama.*;

public class OptCORR_processing_Phase11 {

    // other parameters
	public double delta = -115.1700;
	Matrix delta_tilde = new Matrix(72, 1, delta);
	Matrix Ustartemp;
	public Matrix u_LA_2lastdays;
	
    // KF estimate from the Simulator (1st meal)
 	double[][] x_ini = {{9.666672961387889e-01},
					    {5.395372645858502e-04},
					    {1.890807473827476e+02},
					    {1.125582688460508e+02},
					    {8.543562871959665e+00},
					    {1.123329427067773e+00},
					    {6.880088106873392e+01},
					    {9.733851922892014e+02}};
 	Matrix x = new Matrix(x_ini);
 	
	public OptCORR_processing_Phase11(OptCORR_param optcorr_param) {
    	
	 	// u_LA vector from the Simulator (1st meal)
	 	double[][] u_LA_2lastdays_ini = {{2.261112556636594e+01, 2.240549095179500e+01, 2.220014402425656e+01, 2.199508438127054e+01, 2.179031162092002e+01, 2.158582534185031e+01, 2.138162514326822e+01, 2.117771062494128e+01, 2.097408138719702e+01, 2.077073703092204e+01, 2.056767715756132e+01, 2.036490136911747e+01, 2.016240926814989e+01, 1.996020045777396e+01, 1.975827454166039e+01, 1.955663112403428e+01, 1.935526980967449e+01, 1.915419020391278e+01, 1.895339191263304e+01, 1.875287454227058e+01, 1.855263769981125e+01, 1.835268099279078e+01, 1.815300402929404e+01, 1.795360641795405e+01, 1.775448776795145e+01, 1.755564768901353e+01, 1.735708579141383e+01, 1.715880168597085e+01, 1.696079498404773e+01, 1.676306529755125e+01, 1.656561223893117e+01, 1.636843542117944e+01, 1.617153445782943e+01, 1.597490896295515e+01, 1.577855855117061e+01, 1.558248283762897e+01, 1.538668143802170e+01, 1.519115396857801e+01, 1.499590004606404e+01, 1.480091928778201e+01, 1.460621131156952e+01, 1.441177573579894e+01, 1.421761217937650e+01, 1.402372026174152e+01, 1.383009960286580e+01, 1.363674982325280e+01, 1.344367054393686e+01, 1.325086138648249e+01, 1.305832197298379e+01, 1.286605192606334e+01, 1.267405086887187e+01, 1.248231842508718e+01, 1.229085421891366e+01, 1.209965787508139e+01, 1.190872901884546e+01, 1.171806727598529e+01, 1.152767227280378e+01, 1.133754363612667e+01, 1.114768099330178e+01, 1.095808397219821e+01, 1.076875220120581e+01, 1.057968530923422e+01, 1.039088292571226e+01, 1.020234468058721e+01, 1.001407020432405e+01, 9.826059127904774e+00, 9.638311082827560e+00, 9.450825701106211e+00, 9.263602615269306e+00, 9.076641458359536e+00, 8.889941863932993e+00, 8.703503466058429e+00}};
	 	Matrix pre_u_LA_2lastdays = new Matrix(u_LA_2lastdays_ini);
	 	u_LA_2lastdays = pre_u_LA_2lastdays.transpose();
	 		
        // advised bolus calculation    
        cal_bolus_advised(optcorr_param);
	}
		
	public void  cal_bolus_advised(OptCORR_param optcorr_param) {

		double[][] K_init2 = {{1.648820228773043e-02, -1.454159162093619e+01, -7.636454592399468e-04, -7.610922483068327e-04, -5.946038099618998e-04, 0, 9.277585651743209e-05, 9.044979965323012e-05}};
	    Matrix K = new Matrix(K_init2);
	    
	    double[][] M_init2 = {{-3.817451555744525e-03, -3.810191102615141e-03, -3.794431029522526e-03, -3.770353963769467e-03, -3.738251021083727e-03, -3.698502407539649e-03, -3.651557235798405e-03, -3.597914618012640e-03, -3.538106945850343e-03, -3.472685620940972e-03, -3.402209176238910e-03, -3.327233585829167e-03,-3.248304510356792e-03, -3.165951220003926e-03, -3.080681952126985e-03, -2.992980483946493e-03, -2.903303726051097e-03, -2.812080167146247e-03, -2.719709023256604e-03, -2.626559965068455e-03, -2.532973315232958e-03, -2.439260623367557e-03, -2.345705540381367e-03, -2.252564925818420e-03, -2.160070132363624e-03, -2.068428420678254e-03, -1.977824465495636e-03, -1.888421920565248e-03, -1.800365015719229e-03, -1.713780164167238e-03, -1.628777562206580e-03, -1.545452766954289e-03, -1.463888240543701e-03, -1.384154851546408e-03, -1.306313326238101e-03, -1.230415643771260e-03, -1.156506370388538e-03, -1.084623928540209e-03, -1.014801797182288e-03, -9.470696396479109e-04, -8.814543553158658e-04, -8.179810508538411e-04, -7.566739260913204e-04, -6.975570685739100e-04, -6.406551495574621e-04, -5.859940126014101e-04, -5.336011439951645e-04, -4.835060119723464e-04, -4.357402590020958e-04, -3.903377283556318e-04, -3.473343025847209e-04, -3.067675274668802e-04, -2.686759903175217e-04, -2.330984162922124e-04, -2.000724403675273e-04, -1.696330060998030e-04, -1.418103351081450e-04, -1.166274037888262e-04, -9.409685670673691e-05, -7.421728087619314e-05, -5.696876477287526e-05, -4.230767661476953e-05, -3.016063071092014e-05, -2.041769338202597e-05, -1.292505995101114e-05, -7.477805454659450e-06, -3.814047544693591e-06, -1.613256150443295e-06, -5.039084064997788e-07, -8.937956188099745e-08, -3.871643091594777e-09, 0}};
	    Matrix M = new Matrix(M_init2);
	    
	    double[][] N_init2 = {{0, -2.812334297572259e-07, -6.197234877298283e-06, -2.978797702320113e-05, -7.876241474640502e-05, -1.540454835945141e-04, -2.523979908398368e-04, -3.688024748956158e-04, -4.978819225736771e-04, -6.346061132286021e-04, -7.745863383562209e-04, -9.141564865549087e-04, -1.050351897148977e-03, -1.180844315438141e-03, -1.303862103095906e-03, -1.418109615422560e-03, -1.522691933205700e-03, -1.617047316743542e-03, -1.700887913628768e-03, -1.774148409794166e-03, -1.836941962147485e-03, -1.889522637976498e-03, -1.932253585001042e-03, -1.965580204053962e-03, -1.990007663376018e-03, -2.006082164813289e-03, -2.014375441103878e-03, -2.015472027109344e-03, -2.009958905342446e-03, -1.998417177411118e-03, -1.981415458380458e-03, -1.959504731047172e-03, -1.933214432262705e-03, -1.903049574257404e-03, -1.869488730898016e-03, -1.832982742399956e-03, -1.793954012614194e-03, -1.752796290973084e-03, -1.709874846827109e-03, -1.665526957516018e-03, -1.620062643341715e-03, -1.573765592865943e-03, -1.526894230837069e-03, -1.479682888727967e-03, -1.432343044491877e-03, -1.385064603847708e-03, -1.338017200307666e-03, -1.291351495360803e-03, -1.245200463816757e-03, -1.199680652373776e-03, -1.154893402073926e-03, -1.110926027507222e-03, -1.067852947478982e-03, -1.025736763407832e-03, -9.846292830165985e-04, -9.445724879506483e-04, -9.055994448395278e-04, -8.677351600351424e-04, -8.309973788372219e-04, -7.953973304749865e-04, -7.609404204708418e-04, -7.276268722831560e-04, -6.954523203242311e-04, -6.644083565881904e-04, -6.344830332116827e-04, -6.056613233368101e-04, -5.779255426579319e-04, -5.512557340183933e-04, -5.256300173852410e-04, -5.010249074742706e-04, -4.774156012282702e-04, -4.547762372713999e-04}};
	    Matrix N = new Matrix(N_init2);
	    
	    Ustartemp = K.times(x).plus(M.times(u_LA_2lastdays)).plus(N.times(delta_tilde)); // U
	}
	
}
	